# ISO 8601日历周计算算法流程

## 功能概述
该函数用于根据输入的日期计算ISO 8601标准的日历周数，并计算从当年1月1日起已经过去的天数。

## 主要处理流程

1. **初始化阶段**
   - 初始化临时变量tempDays和tempWeek为0

2. **计算当年已过天数**
   - 调用辅助函数LGF_GetCalendarDay计算从1月1日到输入日期的天数
   - 如果计算过程中出现错误，立即返回错误状态

3. **年份相关计算**
   - 获取当前年份、前一年和后一年的年份值
   - 判断当前年份和前一年是否为闰年

4. **关键日期计算**
   - 计算当前年份1月1日的星期几
   - 计算下一年1月1日的星期几
   - 计算当前年份12月31日的星期几
   - 计算前一年1月1日的星期几
   - 计算前一年12月31日的星期几

5. **53周判断逻辑**
   - 根据ISO 8601标准判断前一年是否有53周
   - 根据ISO 8601标准判断当前年份是否有53周

6. **天数校正**
   - 根据当前年份1月1日是星期几对天数进行校正
   - 使用CASE语句处理不同星期几的情况

7. **周数计算**
   - 处理1月前几天的特殊情况（可能属于前一年的最后一周）
   - 计算常规情况下的周数
   - 处理12月最后几天的特殊情况（可能属于下一年的第一周）

8. **输出结果**
   - 设置输出参数：calendarDay、error、status
   - 返回计算得到的周数

## 关键算法要点
- 闰年判断使用400年、100年和4年的规则
- ISO 8601周数规则：
  - 每周从周一开始
  - 第一周是包含当年第一个星期四的那一周
  - 一年可能有52或53周
- 处理跨年边界情况（1月前3天和12月后3天）

## 错误处理
- 主要错误是日期超出范围(ERR_LIM_DATE)
- 通过error和status参数返回错误状态