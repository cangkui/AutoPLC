

以下是根据需求和代码实现总结的算法流程思维链：

1. 状态机初始化阶段
   - 初始状态设为等待瓶体检测（STATE_WAITING_FOR_BOTTLE）
   - 所有执行机构输出复位（泵/阀门/机械装置/指示灯）

2. 瓶体检测触发流程
   ├─ 当瓶体传感器激活时
   └─ 进入清洗状态（STATE_CLEANING）
       ├─ 启动清洗泵（Pump_Motor = TRUE）
       └─ 等待操作员清洁确认信号

3. 清洗确认处理阶段
   ├─ 收到清洁确认按钮信号
   └─ 进入灌装状态（STATE_FILLING）
       ├─ 关闭清洗泵（Pump_Motor = FALSE）
       ├─ 打开灌装阀门（Filling_Valve = TRUE）
       └─ 等待操作员灌装确认信号

4. 灌装确认处理阶段
   ├─ 收到灌装确认按钮信号
   └─ 进入封盖状态（STATE_CAPPING）
       ├─ 关闭灌装阀门（Filling_Valve = FALSE）
       ├─ 启动封盖机（Capping_Machine = TRUE）
       └─ 等待操作员封盖确认信号

5. 封盖确认处理阶段
   ├─ 收到封盖确认按钮信号
   └─ 进入包装状态（STATE_PACKING）
       ├─ 关闭封盖机（Capping_Machine = FALSE）
       ├─ 启动包装机（Packing_Machine = TRUE）
       └─ 等待操作员包装确认信号

6. 包装完成处理阶段
   ├─ 收到包装确认按钮信号
   └─ 进入完成状态（STATE_COMPLETED）
       ├─ 关闭包装机（Packing_Machine = FALSE）
       ├─ 点亮完成指示灯（Completion_Light = TRUE）
       └─ 等待最终取件确认

7. 系统复位阶段
   ├─ 收到取件完成按钮信号
   └─ 返回初始等待状态（STATE_WAITING_FOR_BOTTLE）
       └─ 熄灭完成指示灯（Completion_Light = FALSE）

特殊处理逻辑：
- 使用状态机循环处理机制确保状态转换立即生效
- 每个状态切换时自动关闭前序设备输出
- 所有中间状态均需要人工确认信号触发流程推进
- 完成指示灯保持常亮直到人工取件确认

该流程通过状态机的立即响应机制实现了：当某个状态转换条件满足时，可以在同一个PLC扫描周期内完成多个连续的状态跳转，直到遇到需要等待人工确认的状态。这种设计既保证了流程的连续性，又保留了必要的人工控制节点。