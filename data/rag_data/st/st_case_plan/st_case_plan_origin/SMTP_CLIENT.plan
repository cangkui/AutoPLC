{"variables": [], "instructions": [], "planning": "- 概述\n这段代码是一个使用SCL编写的功能块，名为“SMTP_CLIENT”，用于通过SMTP协议发送电子邮件。它支持多种认证方式（如PLAIN、LOGIN、CRAM-MD5），并且可以处理带有附件的邮件。功能块通过状态机控制整个邮件发送过程，包括与SMTP服务器的通信、认证、邮件内容的构建和附件的处理。\n\n- 变量定义\n代码中定义了以下几类变量：\n - 输入变量：激活、超时、日期时间、日期时间偏移、DNS服务器IP地址\n - 输出变量：完成、忙、错误代码、错误类型\n - 输入输出变量：服务器地址、发件人、收件人、主题、正文、附件\n - 内部变量：IP控制、网络缓冲区、URL数据、DNS客户端、文件服务器、BASE64编码、MD5认证、状态机步骤、定时器、计数器、标志位等\n\n- - 主逻辑部分\n-- REGION 00:\n   此区域处理功能块的初始化。当激活信号从假变为真时，初始化超时时间、错误标志、URL数据等，并根据用户名和密码判断是否使用ESMTP。然后进入步骤10。\n\n-- REGION 10:\n   此区域处理DNS查询。如果DNS查询完成，则进入步骤20。如果DNS查询出错，则设置错误代码和类型，并进入步骤980。\n\n-- REGION 20:\n   此区域根据URL中的协议（如SSL、TLS）设置SMTP服务器的端口和SSL/TLS模式。然后设置IP控制参数，并进入步骤30。\n\n-- REGION 30:\n   此区域处理与SMTP服务器的初始连接。如果收到服务器的220响应，则根据是否使用ESMTP发送“EHLO”或“HELO”命令，并进入下一步。\n\n-- REGION 40:\n   此区域处理SMTP服务器的250响应。如果服务器支持认证，则进入步骤50，否则进入步骤90。\n\n-- REGION 50:\n   此区域处理认证方式的选择。根据服务器支持的认证方式，设置认证状态，并进入相应的步骤（如1000、1100、1200）。\n\n-- REGION 90:\n   此区域处理邮件发送的准备工作。如果收到服务器的250响应，则发送“MAIL FROM”命令，并进入步骤95。\n\n-- REGION 95:\n   此区域处理收件人列表。如果还有收件人未处理，则进入步骤100，否则进入步骤110。\n\n-- REGION 100:\n   此区域发送“RCPT TO”命令，并继续处理下一个收件人。\n\n-- REGION 110:\n   此区域发送“DATA”命令，并进入步骤120。\n\n-- REGION 120:\n   此区域处理邮件正文的构建。如果收到服务器的354响应，则开始构建邮件头，并进入步骤200。\n\n-- REGION 200:\n   此区域处理邮件头的构建。包括发件人、收件人、主题、日期等内容，并进入步骤250。\n\n-- REGION 250:\n   此区域处理邮件正文的MIME类型和边界设置，并进入步骤260。\n\n-- REGION 260:\n   此区域发送邮件正文内容，并进入步骤270。\n\n-- REGION 270:\n   此区域处理附件的边界设置，并进入步骤280。\n\n-- REGION 280:\n   此区域处理附件的MIME类型和编码设置，并进入步骤290。\n\n-- REGION 290:\n   此区域发送附件内容，并进入步骤300。\n\n-- REGION 300:\n   此区域处理附件的BASE64编码和发送，并进入步骤310。\n\n-- REGION 310:\n   此区域处理附件的发送完成，并进入步骤400。\n\n-- REGION 400:\n   此区域处理附件的删除标志。如果有附件需要删除，则进入步骤910，否则进入步骤950。\n\n-- REGION 800:\n   此区域发送邮件的结束标志，并进入步骤810。\n\n-- REGION 810:\n   此区域发送“QUIT”命令，并进入步骤820。\n\n-- REGION 820:\n   此区域等待服务器的221响应或超时，并进入步骤900。\n\n-- REGION 900:\n   此区域处理附件的删除。如果有附件需要删除，则进入步骤910，否则进入步骤950。\n\n-- REGION 950:\n   此区域设置完成标志，并进入步骤980。\n\n-- REGION 980:\n   此区域关闭IP连接，并重置相关变量，进入步骤990。\n\n-- REGION 990:\n   此区域等待IP连接完全关闭，并回到步骤0。\n\n-- REGION 1000:\n   此区域处理PLAIN认证方式的请求，并进入步骤1010。\n\n-- REGION 1010:\n   此区域处理PLAIN认证方式的响应，并发送用户名和密码的BASE64编码，进入步骤90。\n\n-- REGION 1100:\n   此区域处理LOGIN认证方式的请求，并进入步骤1110。\n\n-- REGION 1110:\n   此区域处理LOGIN认证方式的响应，并发送用户名的BASE64编码，进入步骤1120。\n\n-- REGION 1120:\n   此区域发送用户名的BASE64编码，并进入步骤1130。\n\n-- REGION 1130:\n   此区域发送密码的BASE64编码，并进入步骤90。\n\n-- REGION 1200:\n   此区域处理CRAM-MD5认证方式的请求，并进入步骤1210。\n\n-- REGION 1210:\n   此区域处理CRAM-MD5认证方式的响应，并发送认证密钥，进入步骤90。\n\n-- REGION 1300:\n   此区域处理STARTTLS命令的请求，并进入步骤1310。\n\n-- REGION 1310:\n   此区域处理STARTTLS命令的响应，并进入步骤1320。\n\n-- REGION 1320:\n   此区域等待SSL/TLS握手完成，并回到步骤30。\n\n-- REGION 1900:\n   此区域为空，用于占位。\n\n-- REGION snd_step 00:\n   此区域处理发送缓冲区的构建。将发送文本转换为缓冲区，并添加换行符。如果发送使能为真，则设置发送缓冲区大小，并进入步骤10。\n\n-- REGION snd_step 10:\n   此区域处理发送缓冲区的发送完成。如果发送缓冲区为空，则进入下一步。\n\n-- REGION 错误处理：\n   此区域处理各种错误情况，包括IP连接错误、文件服务器错误、超时等。如果发生错误，则设置错误代码和类型，并进入步骤980。\n\n-- REGION 定时器处理：\n   此区域处理超时定时器。如果超时，则设置错误代码和类型，并进入步骤980。\n\n-- REGION 状态机循环：\n   此区域处理状态机的循环执行。根据当前步骤和接收到的响应，决定下一步的操作。\n\n-- REGION 其他功能：\n   此区域调用DNS客户端、IP控制、文件服务器、BASE64编码等功能块，完成相应的任务。", "name": "SMTP_CLIENT"}