{"variables": [], "instructions": [], "planning": "- 概述\n该功能块 `METER_STAT` 用于统计和记录基于时间周期的累计值。它通过输入值 `IN` 和日期 `DI`，计算并更新每日、每周、每月和每年的累计值。支持通过 `RST` 信号重置所有统计值。\n\n- 变量定义\n代码中定义了以下几类变量：\n - 输入变量：`IN`（当前值，类型为 `REAL`）、`DI`（当前日期，类型为 `DATE`）、`RST`（重置信号，类型为 `BOOL`）。\n - 输入输出变量：`Last_Day`、`Current_Day`、`Last_Week`、`Current_Week`、`Last_Month`、`Current_Month`、`Last_Year`、`Current_Year`，分别表示上一天、当前天、上一周、当前周、上一个月、当前月、上一年、当前年的累计值。\n - 保留变量：`Year_Start`、`Month_Start`、`Week_Start`、`Day_Start` 分别表示年、月、周、天的起始值，`last_run` 表示上一次运行的日期。\n\n- 主逻辑部分\n-- REGION 重置逻辑\n   如果 `RST` 为 `TRUE`，则重置所有统计值。将 `Last_Day`、`Current_Day`、`Last_Week`、`Current_Week`、`Last_Month`、`Current_Month`、`Last_Year`、`Current_Year` 设置为 `0.0`，并将 `Day_Start`、`Week_Start`、`Month_Start`、`Year_Start` 设置为当前输入值 `IN`。\n-- REGION 计算当前累计值\n   如果 `RST` 为 `FALSE`，则计算当前累计值：\n   - `Current_Day` 等于 `IN` 减去 `Day_Start`。\n   - `Current_Week` 等于 `IN` 减去 `Week_Start`。\n   - `Current_Month` 等于 `IN` 减去 `Month_Start`。\n   - `Current_Year` 等于 `IN` 减去 `Year_Start`。\n-- REGION 时间周期更新逻辑\n   根据当前日期 `DI` 和上一次运行日期 `last_run`，检查是否需要更新统计值：\n   - 如果年份变化（`YEAR_OF_DATE(DI) > YEAR_OF_DATE(last_run)`），则更新年、月、天的统计值：\n     - 将 `last_year` 设置为 `current_year`，`current_year` 重置为 `0.0`，`year_start` 设置为 `IN`。\n     - 将 `last_month` 设置为 `current_month`，`current_month` 重置为 `0.0`，`month_start` 设置为 `IN`。\n     - 将 `last_day` 设置为 `current_day`，`current_day` 重置为 `0.0`，`day_start` 设置为 `IN`。\n   - 如果月份变化（`MONTH_OF_DATE(DI) > MONTH_OF_DATE(last_run)`），则更新月、天的统计值：\n     - 将 `last_month` 设置为 `current_month`，`current_month` 重置为 `0.0`，`month_start` 设置为 `IN`。\n     - 将 `last_day` 设置为 `current_day`，`current_day` 重置为 `0.0`，`day_start` 设置为 `IN`。\n   - 如果日期变化（`DAY_OF_YEAR(DI) > DAY_OF_YEAR(last_run)`），则更新天的统计值：\n     - 将 `last_day` 设置为 `current_day`，`current_day` 重置为 `0.0`，`day_start` 设置为 `IN`。\n   - 如果周变化（`DAY_OF_WEEK(DI) < DAY_OF_WEEK(last_run)`），则更新周的统计值：\n     - 将 `last_week` 设置为 `current_week`，`current_week` 重置为 `0.0`，`week_start` 设置为 `IN`。\n-- REGION 更新上一次运行日期\n   将 `last_run` 更新为当前日期 `DI`，以便在下一次运行时进行比较。", "name": "METER_STAT"}