{"variables": [], "instructions": [], "planning": "- 概述\n这个功能块 `DIMM_I` 实现了一个调光控制逻辑，支持多种操作模式，包括设置亮度、重置、单次点击、长按调光、双次点击等。它还支持软调光（渐变调光）和硬调光（直接设置亮度），并提供了最大亮度和最小亮度的限制。\n\n- 变量定义\n代码中定义了以下几类变量：\n - 输入变量：设置（SET）、亮度值（VAL）、输入信号（IN）、重置（RST）、去抖时间（T_DEBOUNCE）、重新配置时间（T_RECONFIG）、最大开启时间（T_ON_MAX）、调光启动时间（T_DIMM_START）、调光时间（T_DIMM）、最小亮度（MIN_ON）、最大亮度（MAX_ON）、软调光标志（SOFT_DIMM）、双次点击切换（DBL_toggle）、重置输出（RST_OUT）。\n - 输出变量：输出状态（Q）、双次点击状态（DBL）。\n - 输入输出变量：输出亮度（OUT）。\n - 内部变量：配置模块（config）、解码模块（decode）、定时器（t3）、调光模块（dim）、调光方向（dir）。\n\n- 主逻辑部分\n-- REGION 配置与解码\n   首先，使用 `config` 模块对输入信号进行去抖和重新配置时间的处理。然后，使用 `decode` 模块对 `config` 的输出进行解码，判断是单次点击、长按还是双次点击。\n\n-- REGION 重置处理\n   如果 `RST` 信号为真，则重置输出亮度 `OUT` 为 0（如果 `RST_OUT` 为真），并将输出状态 `Q` 设置为 `FALSE`。同时，根据当前亮度值 `OUT` 设置调光方向 `dir`。\n\n-- REGION 设置亮度\n   如果 `SET` 信号为真，则将输出亮度 `OUT` 设置为 `VAL`，并将输出状态 `Q` 设置为 `TRUE`。同时，根据当前亮度值 `OUT` 设置调光方向 `dir`。\n\n-- REGION 单次点击处理\n   如果检测到单次点击（`decode.SINGLE`），则切换输出状态 `Q`。如果 `Q` 为 `TRUE`，则将输出亮度 `OUT` 限制在 `MIN_ON` 和 `MAX_ON` 之间。同时，根据当前亮度值 `OUT` 设置调光方向 `dir`。\n\n-- REGION 长按处理\n   如果检测到长按（`decode.TP_LONG`），则根据当前输出状态 `Q` 进行不同处理：\n    - 如果 `Q` 为 `FALSE`，则根据 `SOFT_DIMM` 标志决定是软调光（将 `OUT` 设置为 1）还是硬调光（将 `OUT` 限制在 `MIN_ON` 和 `MAX_ON` 之间），并将 `Q` 设置为 `TRUE`。\n    - 如果 `Q` 为 `TRUE`，则反转调光方向 `dir`。\n\n-- REGION 双次点击处理\n   如果 `DBL_toggle` 为 `FALSE`，则将双次点击状态 `DBL` 设置为 `FALSE`。如果检测到双次点击（`decode.DOUBLE`），则切换双次点击状态 `DBL`。\n\n-- REGION 调光处理\n   使用 `dim` 模块根据调光方向 `dir`、长按信号 `decode.LONG` 和输出状态 `Q` 进行调光处理，调光时间由 `T_DIMM` 控制，调光结果输出到 `OUT`。\n\n-- REGION 调光方向调整\n   如果 `OUT` 为 0，则将调光方向 `dir` 设置为 `TRUE`（递增）。如果 `OUT` 为 255，则将调光方向 `dir` 设置为 `FALSE`（递减）。\n\n-- REGION 最大开启时间处理\n   如果 `T_ON_MAX` 大于 0，则使用定时器 `t3` 来控制输出状态 `Q` 的最大开启时间。当定时器 `t3` 超时时，反转输出状态 `Q`。", "name": "DIMM_I"}