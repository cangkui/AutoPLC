{"variables": [], "instructions": [], "planning": "- 概述\n  这个功能块 `T_AVG24` 用于计算24小时内的温度平均值、最大值和最小值。它通过采样输入温度值，并使用滤波器和时间间隔来控制采样和计算过程。功能块还支持复位、缩放和偏移功能。\n\n- 变量定义\n  代码中定义了以下几类变量：\n  - 输入变量：温度采样值（TS）、日期时间输入（DTI）、复位信号（RST）、滤波器时间（T_FILTER）、缩放比例（SCALE）、偏移量（OFS）。\n  - 输出变量：温度平均值（TA）、触发脉冲（TP）。\n  - 输入输出变量：24小时温度平均值（T24）、24小时温度最大值（T24_MAX）、24小时温度最小值（T24_MIN）。\n  - 内部变量：采样数组（samples）、采样位置（pos）、初始化标志（init）、滤波器实例（ft1）、总和（sum）、上次处理时间（last）。\n  - 临时变量：临时最大值（tmp_max）、临时最小值（tmp_min）、循环计数器（i）。\n\n- 主逻辑部分\n  -- REGION 滤波器处理\n    首先，使用滤波器 `ft1` 对输入的温度采样值 `TS` 进行滤波处理。滤波器的时间常数由 `T_FILTER` 控制，滤波后的值存储在 `ft1.Y` 中。\n\n  -- REGION 初始化逻辑\n    如果复位信号 `RST` 为真，或者功能块尚未初始化（`init` 为假），则进行初始化。初始化过程包括：\n    - 如果 `T24` 的值为 -1000.0，则将其初始化为滤波后的温度值的 0.1 倍。\n    - 将 `samples` 数组中的所有元素初始化为 `T24` 的 10 倍值。\n    - 将 `sum` 初始化为 `samples[0]` 的 48 倍。\n    - 计算并输出当前温度平均值 `TA` 和 24 小时温度平均值 `T24`。\n    - 设置触发脉冲 `TP` 为真，表示计算完成。\n\n  -- REGION 采样和计算逻辑\n    如果当前时间 `DTI` 的分钟部分除以 30 的余数为 0，并且 `DTI` 大于上次处理时间 `last`，则进行采样和计算。具体步骤如下：\n    - 更新 `last` 为当前时间加 1 分钟。\n    - 从 `sum` 中减去当前采样位置 `pos` 处的旧采样值。\n    - 将滤波后的温度值 `ft1.Y` 存储到 `samples[pos]` 中。\n    - 将新采样值加到 `sum` 中。\n    - 更新采样位置 `pos`，使用 `OSCAT_BASIC.INC1` 函数确保 `pos` 在 0 到 47 之间循环。\n    - 计算并输出当前温度平均值 `TA` 和 24 小时温度平均值 `T24`。\n    - 遍历 `samples` 数组，计算 24 小时内的温度最大值 `T24_MAX` 和最小值 `T24_MIN`。\n    - 设置触发脉冲 `TP` 为真，表示计算完成。\n\n  -- REGION 无操作逻辑\n    如果上述条件不满足，则设置触发脉冲 `TP` 为假，表示没有新的计算操作。\n\n- 输出结果\n  功能块的输出包括：\n  - `TA`：当前温度平均值，经过缩放和偏移处理。\n  - `TP`：触发脉冲，表示是否有新的计算操作完成。\n  - `T24`：24 小时温度平均值，经过缩放和偏移处理。\n  - `T24_MAX`：24 小时温度最大值，经过缩放和偏移处理。\n  - `T24_MIN`：24 小时温度最小值，经过缩放和偏移处理。", "name": "T_AVG24"}