{"variables": [], "instructions": [], "planning": "- 概述\n  这段代码是一个使用SCL编写的功能块，名为“MOON_PHASE”，用于计算给定日期时间（DT）的月相。月相的计算基于一个周期性的公式，并通过输入参数进行缩放。功能块还支持根据时间间隔（UPDATE）来更新月相值。\n\n- 变量定义\n  代码中定义了以下几类变量：\n  - 输入变量：XDT（日期时间）、SCALE（缩放比例，默认值为12）、UPDATE（更新间隔，默认值为60分钟）。\n  - 输出变量：PHASE（月相值，范围为0到SCALE-1）。\n  - 内部变量：x（用于存储中间计算结果的32位无符号整数）、last_dt（用于存储上一次处理的日期时间）。\n\n- 主逻辑部分\n  -- REGION 主逻辑\n    功能块的主逻辑部分包含一个条件判断，用于检查是否需要更新月相值。具体逻辑如下：\n    1. 首先，检查当前输入的日期时间（XDT）与上一次处理的日期时间（last_dt）之间的差值是否大于更新间隔（UPDATE）。如果是，则执行以下步骤：\n       - 计算一个中间值x，公式为：`x := (DT_TO_UDINT(XDT) - 603240) MOD 2551392`。这里，`DT_TO_UDINT(XDT)`将日期时间转换为32位无符号整数，`603240`是一个偏移量，`2551392`是月相周期的秒数（约29.53天）。\n       - 将x按比例缩放为月相值，公式为：`PHASE := UDINT_TO_BYTE(SCALE * x / 2551392)`。这里，`SCALE`是缩放比例，`UDINT_TO_BYTE`将32位无符号整数转换为字节。\n       - 更新`last_dt`为当前输入的日期时间（XDT），以便在下一次调用时进行时间间隔检查。\n    2. 如果当前输入的日期时间与上一次处理的日期时间之间的差值不大于更新间隔，则跳过计算，保持当前的月相值不变。\n\n  通过这种方式，功能块可以根据输入的时间间隔（UPDATE）动态更新月相值，避免不必要的计算，提高效率。", "name": "MOON_PHASE"}