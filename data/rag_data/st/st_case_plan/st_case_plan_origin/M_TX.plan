{"variables": [], "instructions": [], "planning": "- 概述\n  该功能块 `M_TX` 用于测量输入信号的占空比（Duty Cycle, DC）、频率（F）、高电平时间（TH）、低电平时间（TL）以及信号的总运行时间（ET）。它通过检测输入信号的上升沿和下降沿来计算这些值，并在复位或达到最大时间时重置所有值。\n\n- 变量定义\n  代码中定义了以下几类变量：\n  - 输入变量：`in`（输入信号）、`tmax`（最大运行时间，默认值为 4 小时）、`rst`（复位信号）。\n  - 输出变量：`TH`（高电平时间）、`TL`（低电平时间）、`DC`（占空比）、`F`（频率）、`ET`（信号的总运行时间）。\n  - 内部变量：`edge`（用于检测信号变化的边缘标志）、`start`（信号上升沿的时间）、`stop`（信号下降沿的时间）、`tx`（当前时间）、`rise`（上升沿标志）、`fall`（下降沿标志）、`startup`（启动标志）。\n\n- 主逻辑部分\n  -- REGION 复位逻辑\n     当复位信号 `rst` 为真，或者总运行时间 `ET` 超过最大时间 `tmax` 时，功能块会重置所有内部状态和输出值。具体操作包括：\n     - 将 `rise` 和 `fall` 标志设置为 `FALSE`，表示没有检测到上升沿或下降沿。\n     - 将 `startup` 标志设置为 `FALSE`，表示功能块需要重新初始化。\n     - 将 `TH`、`TL`、`DC`、`F` 和 `ET` 重置为默认值（0 或 `t#0ms`）。\n\n  -- REGION 初始化逻辑\n     如果功能块未初始化（`startup` 为 `FALSE`），则将 `edge` 设置为当前输入信号 `in` 的值，并将 `startup` 设置为 `TRUE`，表示功能块已完成初始化。\n\n  -- REGION 时间获取逻辑\n     使用 `DWORD_TO_TIME(T_PLC_MS())` 获取当前时间，并将其存储在 `tx` 变量中。`T_PLC_MS()` 是获取 PLC 当前时间的函数，`DWORD_TO_TIME` 将其转换为 `TIME` 类型。\n\n  -- REGION 边缘检测与计算逻辑\n     当输入信号 `in` 发生变化时（通过 `in XOR edge` 检测），更新 `edge` 的值，并根据信号的变化类型（上升沿或下降沿）执行以下操作：\n     - 如果是上升沿（`in` 为 `TRUE`）：\n       - 记录当前时间 `tx` 到 `start` 中，表示信号开始高电平。\n       - 将 `rise` 标志设置为 `TRUE`，表示检测到上升沿。\n       - 如果之前检测到下降沿（`fall` 为 `TRUE`），则计算低电平时间 `TL`，即 `start - stop`。\n       - 如果 `TH` 和 `TL` 都大于 0，则计算占空比 `DC` 和频率 `F`。占空比是 `TH` 与 `TH + TL` 的比值，频率是 `1000 / (TH + TL)`。\n     - 如果是下降沿（`in` 为 `FALSE`）：\n       - 记录当前时间 `tx` 到 `stop` 中，表示信号开始低电平。\n       - 将 `fall` 标志设置为 `TRUE`，表示检测到下降沿。\n       - 如果之前检测到上升沿（`rise` 为 `TRUE`），则计算高电平时间 `TH`，即 `stop - start`。\n       - 如果 `TH` 和 `TL` 都大于 0，则计算占空比 `DC` 和频率 `F`，方法与上升沿相同。\n\n  -- REGION 总运行时间计算逻辑\n     如果检测到上升沿（`rise` 为 `TRUE`），则计算总运行时间 `ET`，即当前时间 `tx` 减去信号开始时间 `start`。\n\n- 总结\n  该功能块通过检测输入信号的上升沿和下降沿，计算信号的高电平时间、低电平时间、占空比、频率以及总运行时间。它支持复位功能，并在达到最大运行时间时自动重置。该功能块适用于需要实时监控和分析信号特性的场景。", "name": "M_TX"}