{"variables": [], "instructions": [], "planning": "- 概述\n这个功能块名为“IRTRANS_SND_4”，用于处理红外信号的发送。它根据输入信号选择相应的键码，并将其转换为字符串格式，然后通过网络缓冲区发送出去。功能块还包含一个定时器，用于控制重复发送的时间间隔。\n\n- 变量定义\n代码中定义了以下几类变量：\n - 输入变量：设备代码、键码（4个）、输入信号（4个）、重复时间\n - 输入输出变量：IP控制结构、网络缓冲区\n - 输出变量：键值\n - 内部变量：键字符串、字符串大小、字符串、定时器、当前键值、上一个键值、设备状态\n\n- 主逻辑部分\n-- REGION 设备状态检查\n   首先，检查设备状态。如果设备状态大于127且（邮箱中有数据或控制模式不等于5），则继续执行。否则，直接返回。\n-- REGION 定时器处理\n   使用定时器TON来控制重复发送的时间间隔。定时器的输入是当前键值等于上一个键值，定时器的时间参数为T_REPEAT。\n-- REGION 键码选择\n   如果网络缓冲区的大小为0，则根据输入信号选择相应的键码。如果IN_0为真，则选择KEY_CODE_0；如果IN_1为真，则选择KEY_CODE_1；如果IN_2为真，则选择KEY_CODE_2；如果IN_3为真，则选择KEY_CODE_3。如果没有输入信号，则重置上一个键值和输出键值，并返回。\n-- REGION 字符串构建与发送\n   如果当前键值不等于上一个键值或定时器到达设定时间，则构建发送字符串。字符串格式为“snd 设备代码,键码”。然后，将字符串转换为网络缓冲区中的数据，并设置缓冲区的大小。最后，更新输出键值和上一个键值，并重置定时器。", "name": "IRTRANS_SND_4"}