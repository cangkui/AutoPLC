{"variables": [], "instructions": [], "planning": "- 概述\n这段代码是一个功能块 `BLIND_INPUT`，用于控制百叶窗或类似设备的输入处理。它处理来自按钮或开关的信号，并根据不同的输入状态（如单击、双击、长按等）来更新百叶窗的状态和位置。功能块还支持手动和自动模式切换，并可以处理超时和去抖动逻辑。\n\n- 变量定义\n代码中定义了以下几类变量：\n  - 输入变量：包括位置（POS）、角度（ANG）、开关信号（S1、S2）、输入信号（IN）、手动输入（PI、AI）、单开关模式（SINGLE_SWITCH）、单击使能（CLICK_EN）、单击时间（CLICK_TIME）、最大运行时间（MAX_RUNTIME）、手动超时时间（MANUAL_TIMEOUT）、去抖动时间（DEBOUNCE_TIME）、双击信号（DBL_CLK1、DBL_CLK2）、双击位置（DBL_POS1、DBL_POS2）、双击角度（DBL_ANG1、DBL_ANG2）、双击切换（D1_TOGGLE、D2_TOGGLE）、主模式（MASTER_MODE）。\n  - 输出变量：包括向上状态（QU）、向下状态（QD）、状态（STATUS）、输出位置（PO）、输出角度（AO）、双击输出（D1、D2）。\n  - 内部变量：包括去抖动定时器（s1e、s2e）、单击模式（s1d、s2d）、方向（dir）、当前时间（tx）、上次操作时间（last）。\n\n- - 主逻辑部分\n-- REGION 初始化\n    首先，将当前时间（tx）设置为PLC的毫秒时间。这用于后续的时间计算和超时处理。接着，初始化去抖动定时器（s1e、s2e）和单击模式（s1d、s2d）。去抖动定时器用于消除开关信号的抖动，确保信号的稳定性。单击模式用于检测单击、双击和长按操作，并根据不同的操作模式更新状态。\n\n-- REGION 双击切换处理\n    如果双击切换（D1_TOGGLE 或 D2_TOGGLE）为假，则相应的双击输出（D1 或 D2）设置为假。这确保了在某些配置下，双击功能可以被禁用。\n\n-- REGION 状态处理\n    根据单击模式（s1d、s2d）的状态和输入信号（IN），更新状态（STATUS）和方向（dir）。具体逻辑如下：\n    - 如果检测到长按或状态为139，则设置状态为139。这表示设备处于停止状态。\n    - 如果检测到S1的长按，则设置状态为132。这表示设备正在向上运行。\n    - 如果检测到S2的长按，则设置状态为133。这表示设备正在向下运行。\n    - 如果检测到S1的单击，则根据方向切换状态为134。如果单击使能（CLICK_EN）为真，则进一步检查设备是否已经在运行（QU XOR QD）。如果设备已经在运行，则设置状态为131（停止状态）；否则，设置状态为134（向上运行状态），并记录当前时间（last）和切换方向（dir）。\n    - 如果检测到S2的单击，则根据方向切换状态为135。如果单击使能（CLICK_EN）为真，则进一步检查设备是否已经在运行（QU XOR QD）。如果设备已经在运行，则设置状态为131（停止状态）；否则，设置状态为135（向下运行状态），并记录当前时间（last）和切换方向（dir）。\n    - 如果检测到输入信号（IN），则设置状态为136。这表示设备处于输入状态，并记录当前时间（last）。\n    - 如果检测到S1的双击，则根据双击使能（DBL_CLK1）设置状态为137或切换D1状态。如果双击使能（DBL_CLK1）为真，则设置状态为137（双击1状态），并记录当前时间（last）；否则，切换D1状态。\n    - 如果检测到S2的双击，则根据双击使能（DBL_CLK2）设置状态为138或切换D2状态。如果双击使能（DBL_CLK2）为真，则设置状态为138（双击2状态），并记录当前时间（last）；否则，根据单开关模式（SINGLE_SWITCH）切换D1或D2状态。\n\n-- REGION 状态机\n    根据状态（STATUS）的值，执行不同的逻辑：\n    - 状态0：默认状态，设置为130（正常状态）。\n    - 状态130：正常状态，更新输出位置（PO）和输出角度（AO），并设置向上（QU）和向下（QD）状态为真。如果不在主模式（MASTER_MODE），则更新输出位置（PO）和输出角度（AO）为输入值（POS、ANG）。\n    - 状态131：停止状态，设置向上（QU）和向下（QD）状态为假，并更新输出位置（PO）和输出角度（AO）。如果当前时间（tx）减去上次操作时间（last）大于等于手动超时时间（MANUAL_TIMEOUT），则返回状态130。\n    - 状态132：向上状态，设置向上（QU）为真，向下（QD）为假，并更新输出位置（PO）和输出角度（AO）。如果长按结束（s1d.LONG为假），则返回状态131，并切换方向（dir）。\n    - 状态133：向下状态，设置向上（QU）为假，向下（QD）为真，并更新输出位置（PO）和输出角度（AO）。如果长按结束（s2d.LONG为假），则返回状态131，并切换方向（dir）。\n    - 状态134：向上运行状态，设置向上（QU）为真，向下（QD）为假，并更新输出位置（PO）和输出角度（AO）。如果当前时间（tx）减去上次操作时间（last）大于等于最大运行时间（MAX_RUNTIME），则返回状态131。\n    - 状态135：向下运行状态，设置向上（QU）为假，向下（QD）为真，并更新输出位置（PO）和输出角度（AO）。如果当前时间（tx）减去上次操作时间（last）大于等于最大运行时间（MAX_RUNTIME），则返回状态131。\n    - 状态136：输入状态，设置向上（QU）和向下（QD）状态为真，并更新输出位置（PO）和输出角度（AO）为输入值（PI、AI）。如果当前时间（tx）减去上次操作时间（last）大于等于最大运行时间（MAX_RUNTIME），则返回状态130。\n    - 状态137：双击1状态，设置向上（QU）和向下（QD）状态为真，并更新输出位置（PO）和输出角度（AO）为双击1的值（DBL_POS1、DBL_ANG1）。如果当前时间（tx）减去上次操作时间（last）大于等于最大运行时间（MAX_RUNTIME），则返回状态131。\n    - 状态138：双击2状态，设置向上（QU）和向下（QD）状态为真，并更新输出位置（PO）和输出角度（AO）为双击2的值（DBL_POS2、DBL_ANG2）。如果当前时间（tx）减去上次操作时间（last）大于等于最大运行时间（MAX_RUNTIME），则返回状态131。\n    - 状态139：停止状态，设置向上（QU）和向下（QD）状态为假，并更新输出位置（PO）和输出角度（AO）。", "name": "BLIND_INPUT"}