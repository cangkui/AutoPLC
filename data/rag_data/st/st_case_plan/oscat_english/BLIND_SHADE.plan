Natural Language Requirements:  
{"variables": [], "instructions": [], "planning": "- Overview\n  This code implements a function block named 'BLIND_SHADE' for controlling the raising/lowering and angle adjustment of blinds. It determines the state and angle of the blinds based on the sun's position, time, and other input parameters. The function block also considers parameters such as sunrise/sunset time offsets, sun direction and angle offsets, blind delay time, etc.\n\n- Variable Definitions\n  The code defines the following types of variables:\n  - Input variables: UP (raise command), DN (lower command), S_IN (status input), PI (position input), AI (angle input), ENABLE (enable), SUN (sun status), sunrise_offset (sunrise time offset), sunset_preset (sunset preset time), direction (sun direction), angle_offset (angle offset), slat_width (blind slat width), Slat_spacing (blind slat spacing), Shade_delay (blind delay time), Shade_pos (blind position).\n  - Input/output variable: CX (calendar object for retrieving sun position and time information).\n  - Output variables: QU (raise output), QD (lower output), STATUS (status output), PO (position output), AO (angle output).\n  - Internal variables: angle (calculated blind angle), sun_delay (timer for delaying the sun signal).\n\n- Main Logic Section\n  -- REGION Sun Delay Handling\n    First, the `SUN` signal is delayed using the `sun_delay` timer. The timer's input is the `SUN` signal, and the delay time is `Shade_delay`. The timer's output `Q` is used for subsequent logic decisions.\n\n  -- REGION Blind Control Logic\n    The function block executes automatic blind control logic when the following conditions are met:\n    - Both `UP` and `DN` signals are true.\n    - The `ENABLE` signal is true.\n    - `sun_delay.Q` is true (sun signal delay has ended).\n    - The sun's horizontal angle is between `direction - angle_offset` and `direction + angle_offset`.\n    - The current time is between sunrise (plus `sunrise_offset`) and sunset (minus `sunset_preset`).\n\n    If the above conditions are met, the function block performs the following actions:\n    - Sets `STATUS` to 151, indicating the blinds are in automatic control mode.\n    - Sets `QU` and `QD` to the values of `UP` and `DN` to control the raising/lowering of the blinds.\n    - Sets `PO` to `Shade_pos` to output the blind position.\n    - Calculates the blind angle `angle` by first computing the ratio of slat spacing to slat width, then further adjusts the angle based on the sun's vertical angle. If the sun's vertical angle is between 0 and `angle`, the angle is adjusted and output to `AO`; otherwise, `AO` is set to 255 (maximum angle).\n\n    If the above conditions are not met, the function block performs the following actions:\n    - Sets `QU` and `QD` to the values of `UP` and `DN` to control the raising/lowering of the blinds.\n    - Sets `PO` to `PI` to output the input position.\n    - Sets `AO` to `AI` to output the input angle.\n    - Sets `STATUS` to `S_IN` to output the input status.\n\n  -- REGION Angle Calculation\n    The function block calculates the blind angle based on the sun's vertical angle and the ratio of slat spacing to slat width. First, the `ATAN` function is used to compute the angle corresponding to the ratio. Then, if the sun's vertical angle is between 0 and `angle`, the angle is further adjusted and limited to a range of 0 to 255 using the `LIMIT` function before being output to `AO`. If the sun's vertical angle is outside this range, `AO` is set to 255 (maximum angle).\n\n  -- REGION Output Handling\n    The function block determines the output values of `QU`, `QD`, `PO`, `AO`, and `STATUS` based on conditions. If the conditions are met, it outputs the results of automatic control; otherwise, it outputs the input values.", "name": "BLIND_SHADE"}