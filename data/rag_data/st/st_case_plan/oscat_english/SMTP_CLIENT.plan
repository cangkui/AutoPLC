Natural Language Requirements: {"variables": [], "instructions": [], "planning": "- Overview\nThis code is a function block written in SCL, named 'SMTP_CLIENT', designed to send emails via the SMTP protocol. It supports multiple authentication methods (such as PLAIN, LOGIN, CRAM-MD5) and can handle emails with attachments. The function block controls the entire email sending process through a state machine, including communication with the SMTP server, authentication, email content construction, and attachment handling.\n\n- Variable Definitions\nThe code defines the following types of variables:\n - Input variables: Activation, Timeout, Date Time, Date Time Offset, DNS Server IP Address\n - Output variables: Done, Busy, Error Code, Error Type\n - Input/Output variables: Server Address, Sender, Recipient, Subject, Body, Attachment\n - Internal variables: IP Control, Network Buffer, URL Data, DNS Client, File Server, BASE64 Encoding, MD5 Authentication, State Machine Steps, Timers, Counters, Flags, etc.\n\n- Main Logic Section\n-- REGION 00:\n   This region handles the initialization of the function block. When the activation signal changes from false to true, it initializes the timeout, error flags, URL data, etc., and determines whether to use ESMTP based on the username and password. It then proceeds to step 10.\n\n-- REGION 10:\n   This region handles DNS queries. If the DNS query is completed, it proceeds to step 20. If there is an error in the DNS query, it sets the error code and type and proceeds to step 980.\n\n-- REGION 20:\n   This region sets the SMTP server's port and SSL/TLS mode based on the protocol in the URL (e.g., SSL, TLS). It then sets the IP control parameters and proceeds to step 30.\n\n-- REGION 30:\n   This region handles the initial connection to the SMTP server. If a 220 response is received from the server, it sends the 'EHLO' or 'HELO' command based on whether ESMTP is used and proceeds to the next step.\n\n-- REGION 40:\n   This region handles the SMTP server's 250 response. If the server supports authentication, it proceeds to step 50; otherwise, it proceeds to step 90.\n\n-- REGION 50:\n   This region handles the selection of the authentication method. Based on the authentication methods supported by the server, it sets the authentication state and proceeds to the corresponding steps (e.g., 1000, 1100, 1200).\n\n-- REGION 90:\n   This region handles the preparation for sending the email. If a 250 response is received from the server, it sends the 'MAIL FROM' command and proceeds to step 95.\n\n-- REGION 95:\n   This region handles the recipient list. If there are still recipients to process, it proceeds to step 100; otherwise, it proceeds to step 110.\n\n-- REGION 100:\n   This region sends the 'RCPT TO' command and continues processing the next recipient.\n\n-- REGION 110:\n   This region sends the 'DATA' command and proceeds to step 120.\n\n-- REGION 120:\n   This region handles the construction of the email body. If a 354 response is received from the server, it starts building the email header and proceeds to step 200.\n\n-- REGION 200:\n   This region handles the construction of the email header, including sender, recipient, subject, date, etc., and proceeds to step 250.\n\n-- REGION 250:\n   This region handles the MIME type and boundary settings for the email body and proceeds to step 260.\n\n-- REGION 260:\n   This region sends the email body content and proceeds to step 270.\n\n-- REGION 270:\n   This region handles the boundary settings for attachments and proceeds to step 280.\n\n-- REGION 280:\n   This region handles the MIME type and encoding settings for attachments and proceeds to step 290.\n\n-- REGION 290:\n   This region sends the attachment content and proceeds to step 300.\n\n-- REGION 300:\n   This region handles the BASE64 encoding and sending of attachments and proceeds to step 310.\n\n-- REGION 310:\n   This region handles the completion of attachment sending and proceeds to step 400.\n\n-- REGION 400:\n   This region handles the deletion flag for attachments. If there are attachments to delete, it proceeds to step 910; otherwise, it proceeds to step 950.\n\n-- REGION 800:\n   This region sends the end flag for the email and proceeds to step 810.\n\n-- REGION 810:\n   This region sends the 'QUIT' command and proceeds to step 820.\n\n-- REGION 820:\n   This region waits for the server's 221 response or timeout and proceeds to step 900.\n\n-- REGION 900:\n   This region handles the deletion of attachments. If there are attachments to delete, it proceeds to step 910; otherwise, it proceeds to step 950.\n\n-- REGION 950:\n   This region sets the completion flag and proceeds to step 980.\n\n-- REGION 980:\n   This region closes the IP connection, resets related variables, and proceeds to step 990.\n\n-- REGION 990:\n   This region waits for the IP connection to fully close and returns to step 0.\n\n-- REGION 1000:\n   This region handles the request for PLAIN authentication and proceeds to step 1010.\n\n-- REGION 1010:\n   This region handles the response for PLAIN authentication and sends the BASE64-encoded username and password, proceeding to step 90.\n\n-- REGION 1100:\n   This region handles the request for LOGIN authentication and proceeds to step 1110.\n\n-- REGION 1110:\n   This region handles the response for LOGIN authentication and sends the BASE64-encoded username, proceeding to step 1120.\n\n-- REGION 1120:\n   This region sends the BASE64-encoded username and proceeds to step 1130.\n\n-- REGION 1130:\n   This region sends the BASE64-encoded password and proceeds to step 90.\n\n-- REGION 1200:\n   This region handles the request for CRAM-MD5 authentication and proceeds to step 1210.\n\n-- REGION 1210:\n   This region handles the response for CRAM-MD5 authentication and sends the authentication key, proceeding to step 90.\n\n-- REGION 1300:\n   This region handles the request for the STARTTLS command and proceeds to step 1310.\n\n-- REGION 1310:\n   This region handles the response for the STARTTLS command and proceeds to step 1320.\n\n-- REGION 1320:\n   This region waits for the SSL/TLS handshake to complete and returns to step 30.\n\n-- REGION 1900:\n   This region is empty and serves as a placeholder.\n\n-- REGION snd_step 00:\n   This region handles the construction of the send buffer. It converts the send text into a buffer and adds a newline character. If the send enable is true, it sets the send buffer size and proceeds to step 10.\n\n-- REGION snd_step 10:\n   This region handles the completion of sending the buffer. If the send buffer is empty, it proceeds to the next step.\n\n-- REGION Error Handling:\n   This region handles various error conditions, including IP connection errors, file server errors, timeouts, etc. If an error occurs, it sets the error code and type and proceeds to step 980.\n\n-- REGION Timer Handling:\n   This region handles the timeout timer. If a timeout occurs, it sets the error code and type and proceeds to step 980.\n\n-- REGION State Machine Loop:\n   This region handles the cyclic execution of the state machine. Based on the current step and the received response, it determines the next operation.\n\n-- REGION Other Functions:\n   This region calls function blocks such as DNS Client, IP Control, File Server, BASE64 Encoding, etc., to complete corresponding tasks.", "name": "SMTP_CLIENT"}