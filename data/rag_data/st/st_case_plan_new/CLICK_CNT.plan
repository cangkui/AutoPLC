

- 概述
  该功能块用于检测输入信号在指定时间窗口内的脉冲次数，当达到预定次数时触发单周期脉冲输出。特别处理N=0时仅有上升沿无下降沿的特殊场景。

- 变量定义
  - 输入：
    - IN（BOOL）：脉冲信号输入
    - N（INT）：目标脉冲次数阈值
    - TC（TIME）：检测时间窗口
  - 输出：
    - Q（BOOL）：单周期有效触发信号
  - 内部变量：
    - tx（TP）：脉冲定时器
    - edge（BOOL）：输入信号边沿记忆
    - cnt（INT）：脉冲计数器（初始值-1表示未激活状态）

- 主逻辑流程
  1. 初始化阶段：
     - 每周期复位输出Q为FALSE
     - 通过edge变量记忆输入信号前一周期状态

  2. 触发检测：
     IF条件链：
     a) 上升沿触发：
        - 当检测到IN上升沿（当前为TRUE且edge为FALSE）
        - 且定时器未运行（tx.Q为FALSE）
        → 重置计数器cnt=0，启动定时器tx(pt=TC)

     b) 脉冲计数阶段：
        - 当定时器运行中（tx.Q为TRUE）
        - 且检测到IN下降沿（当前为FALSE且edge为TRUE）
        → 计数器cnt自增

     c) 定时器超时处理：
        - 当定时器停止（tx.Q变为FALSE）
        → 比较当前cnt与N值，若匹配则置位Q
        → 重置计数器为-1（返回未激活状态）

  3. 定时器管理：
     - 持续调用tx定时器模块，当IN为TRUE时维持定时器运行

- 特殊处理
  - N=0场景：
    当定时器超时且cnt保持0（初始值），说明仅有上升沿但无下降沿，满足Q触发条件
  - 单周期脉冲保证：
    输出Q仅在定时器超时的第一个周期有效，后续周期自动复位

- 时序逻辑
  典型工作流程：
  1. IN出现上升沿 → 启动TC定时器
  2. 在TC时间窗口内：
     - 每个IN下降沿使cnt+1
  3. TC时间到：
     - 若cnt == N → Q输出TRUE（仅1个PLC周期）
     - 重置计数器和定时器状态